@startuml StateMachineReworkHR600Base

skinparam state {
  BackgroundColor White
  BorderColor Black
  ArrowColor Black
}

skinparam ArrowThickness 1.2
skinparam NoteBorderThickness 1
skinparam StateBorderThickness 1.5
skinparam StateBackgroundColor LightBlue

[*] --> Undefined

state Undefined {
}

state SelectProfile {
}

state Reference {
}

state AdjustPcb {
}

state PrepareScavenging {
}

state AdjustCrosshair {
}

state AdjustTeSensor {
}

state InsertScavengingPipette {
}

state Desolder {
}

state CleanBoard {
}

state FinishRework {
}

state CanceledWorkflow {
}

' Starting from Undefined
Undefined --> Undefined : Logout
Undefined --> SelectProfile : NextStep

' SelectProfile transitions
SelectProfile --> Undefined : Logout
SelectProfile --> AdjustPcb : NextStep [IsAlreadyReferenced && \nProfileSelected && \nExtendedHeatersActive]
SelectProfile --> PrepareScavenging : NextStep [IsAlreadyReferenced && \nScavengerIsActive && \nScavengingSelected]
SelectProfile --> AdjustCrosshair : NextStep [IsAlreadyReferenced && \nIsDesolderSelected && \nProfileSelected && \nPcbFrameInLockPosition]
SelectProfile --> Reference : NextStep [ProfileSelected]
SelectProfile --> InsertScavengingPipette : NextStep [ScavengingSelected && \nProfileSelected && \nIsAlreadyReferenced]

' Reference transitions
Reference --> ProvideComponent : NextStep [IsReferenceFinished && \nIsCyclicWorkflowMode && \nPcbFrameInLockPosition]
Reference --> AdjustPcb : NextStep [IsReferenceFinished && \nExtendedHeatersActive]
Reference --> PrepareScavenging : NextStep [IsReferenceFinished && \nScavengerIsActive && \nScavengingSelected]
Reference --> AdjustCrosshair : NextStep [IsReferenceFinished && \nIsDesolderSelected && \nPcbFrameInLockPosition]
Reference --> InsertScavengingPipette : NextStep [IsReferenceFinished && \nScavengingSelected]
Reference --> CanceledWorkflow : CancelRework

' AdjustPcb transitions
AdjustPcb --> PrepareScavenging : NextStep [ScavengerIsActive && \nScavengingSelected]
AdjustPcb --> AdjustCrosshair : NextStep [IsDesolderSelected]
AdjustPcb --> FinishRework : NextStep
AdjustPcb --> CanceledWorkflow : CancelRework

' AdjustCrosshair transitions
AdjustCrosshair --> AdjustTeSensor : NextStep [AdjustDriveFinished]
AdjustCrosshair --> CanceledWorkflow : CancelRework

' AdjustTeSensor transitions
AdjustTeSensor --> InsertScavengingPipette : NextStep [ScavengerIsActive && \nScavengingSelected && \nPrepareScavengingFinished]
AdjustTeSensor --> Desolder : NextStep [AdjustDriveFinished && \nIsDesolderSelected]
AdjustTeSensor --> FinishRework : NextStep
AdjustTeSensor --> CanceledWorkflow : CancelRework

' PrepareScavenging transitions
PrepareScavenging --> AdjustTeSensor : NextStep [ScavengerIsActive && \nScavengingSelected && \nPrepareScavengingFinished]
PrepareScavenging --> CanceledWorkflow : CancelRework

' InsertScavengingPipette transitions
InsertScavengingPipette --> Desolder : NextStep [InsertScavengingPipetteFinished]
InsertScavengingPipette --> CanceledWorkflow : CancelRework

' Desolder transitions
Desolder --> ScavengingElement : NextStep [ScavengerIsActive && \nScavengingSelected && \nIsDesolderFinished]
Desolder --> CleanBoard : NextStep [IsDesolderFinished]
Desolder --> AdjustCrosshair : PreviousStep
Desolder --> CanceledWorkflow : CancelRework

' CleanBoard transitions
CleanBoard --> FinishRework : NextStep
CleanBoard --> CanceledWorkflow : CancelRework

' FinishRework transitions
FinishRework --> Reference : NextStep
FinishRework --> Reference : RedoRework
FinishRework --> SelectProfile : CancelRework

' CanceledWorkflow transitions
CanceledWorkflow --> Undefined : Logout
CanceledWorkflow --> Reference : RedoRework
CanceledWorkflow --> SelectProfile : CancelRework

note right of Undefined
  Starting state
end note

@enduml